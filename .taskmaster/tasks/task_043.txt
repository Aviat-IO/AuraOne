# Task ID: 43
# Title: Replace location tracking with flutter_background_geolocation
# Status: pending
# Dependencies: 3
# Priority: high
# Description: Replace current location tracking implementation with flutter_background_geolocation package. This involves Android configuration changes, dependency updates, and code migration.
# Details:
Migrate from current location tracking to flutter_background_geolocation package with full Android configuration. This is a commercial package that provides robust background location tracking capabilities.

# Test Strategy:
Test background location tracking in various scenarios: app in foreground, background, and terminated states. Verify location updates are received and stored correctly. Test battery usage and ensure location permissions are properly requested.

# Subtasks:
## 1. Add flutter_background_geolocation dependency [pending]
### Dependencies: None
### Description: Add flutter_background_geolocation package to pubspec.yaml
### Details:
Add flutter_background_geolocation: ^4.18.5 to dependencies in pubspec.yaml and run flutter pub get

## 2. Configure AndroidManifest.xml [pending]
### Dependencies: None
### Description: Add tools:replace attribute for android:label to AndroidManifest.xml
### Details:
Add xmlns:tools="http://schemas.android.com/tools" to manifest tag and tools:replace="android:label" to application tag in mobile-app/android/app/src/main/AndroidManifest.xml

## 3. Configure root build.gradle.kts [pending]
### Dependencies: None
### Description: Add required maven repositories and version configurations to android/build.gradle.kts
### Details:
Add ext variables for appCompatVersion (1.4.2) and playServicesLocationVersion (21.3.0). Add maven repositories for flutter_background_geolocation and background_fetch in allprojects.repositories block

## 4. Configure app build.gradle.kts [pending]
### Dependencies: None
### Description: Apply background_geolocation.gradle and disable resource shrinking
### Details:
Add val backgroundGeolocation = project(":flutter_background_geolocation") and apply background_geolocation.gradle. Set isShrinkResources = false in release buildType

## 5. Create location tracking service wrapper [pending]
### Dependencies: None
### Description: Create a new service class to wrap flutter_background_geolocation API
### Details:
Create mobile-app/lib/services/background_location_service.dart that provides a clean interface for location tracking using flutter_background_geolocation. Include methods for initialization, start/stop tracking, and location updates stream

## 6. Migrate existing location tracking logic [pending]
### Dependencies: None
### Description: Replace current location tracking implementation with new service
### Details:
Update all references to old location tracking to use the new BackgroundLocationService. Ensure location data format is compatible with existing database schema and UI components

## 7. Update location permissions handling [pending]
### Dependencies: None
### Description: Ensure proper location permissions are requested and handled
### Details:
Verify that location permissions (ACCESS_FINE_LOCATION, ACCESS_COARSE_LOCATION, ACCESS_BACKGROUND_LOCATION) are properly declared and requested at runtime. Update permission request flow if needed

## 8. Test background location tracking [pending]
### Dependencies: None
### Description: Comprehensive testing of location tracking in all app states
### Details:
Test location tracking when app is in foreground, background, and terminated. Verify location updates are received, stored in database, and displayed correctly. Test battery usage and ensure no excessive drain

## 9. Remove old location tracking dependencies [pending]
### Dependencies: None
### Description: Clean up old location tracking code and dependencies
### Details:
Remove old location tracking packages from pubspec.yaml. Delete unused location tracking service files. Clean up any references to old location tracking code

