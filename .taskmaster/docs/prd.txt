

# **Product Requirements and Technical Design for "Aura One": A Local-First, AI-Powered Automatic Journaling Application**

## **Part I: Product Requirements Document (PRD)**

### **1\. Product Vision and Core Principles**

#### **1.1. The "Effortless Chronicle": Defining the Automatic Journal**

The core vision for this application is to redefine digital journaling by shifting the paradigm from active creation to passive curation. It will function as a "lifelogging" application, a term for a comprehensive, personal record of one's daily life captured with a high degree of detail.1 The primary objective is to construct a rich, multimedia narrative of the user's day with minimal direct input, thereby solving the common challenges of time commitment and writer's block associated with traditional journaling.

This approach fundamentally differs from the models of established applications. While market leaders like Day One and Journey provide elegant tools for users to manually document their lives 2, this app's premise is to first automatically assemble the day's chronicle from a variety of data streams. The user's primary role is then transformed from that of an author starting with a blank page to an editor refining a detailed draft. This "effortless chronicle" aims to provide a powerful tool for self-awareness and memory preservation, capturing the granular details of life that are often forgotten. The ultimate goal is to create a living digital autobiography that can help users identify patterns and improve their lives through enhanced self-reflection, embodying the core promise of the lifelogging concept.4

#### **1.2. Naming Exploration**

The working title "Aura One" is a placeholder. A final name should reflect the core principles of automatic capture, memory, privacy, and personal insight. The following are alternative name suggestions for consideration 5:

* **Evoking Automation & Memory:** Chronicle, Life Ledger, Memoir Mark, Tale Track, Vibe Vault.
* **Evoking Privacy & Security:** Signal Journal, Proton Notes, Private Zone, Standard Notes, Hushed.
* **Creative & Evocative:** Ink Chronicles, Quill Quest, Echo Journals, Pulse Pages, Mindful Ink.

Candidates

* Myjourney.one
* oneaura.live
* auraone.life
* auraone.bio
* auraone.live

#### **1.3. Pillars of the Product: Privacy, Sovereignty, and Transparency**

The application is founded on a set of non-negotiable principles that prioritize the user's control over their personal data. These pillars are the primary strategic differentiators in a market dominated by cloud-based services.

* **Privacy by Design (Local-First):** The architectural foundation is a strict local-first model. All user data, including journal entries, media, and metadata, will reside exclusively on the user's device. This is a direct and deliberate departure from the cloud-centric synchronization models employed by most popular journaling apps, including Day One, Rosebud, and Journey.2 This architecture aligns with the ideals of local-first software, which grant the user ultimate ownership and control, making network connectivity an optional convenience rather than a core requirement.15 This choice positions the app as a fortress of privacy, akin to how Penzu is regarded for its "rock-solid security" 2, but with a modern, AI-enhanced feature set.
* **Data Sovereignty (Exportability):** Users will have the unequivocal right and ability to export their entire journal at any time. The export format will be non-proprietary, machine-readable, and thoroughly documented to ensure the data's long-term accessibility and utility outside the application. This commitment to data portability is a cornerstone of user sovereignty and a feature offered by user-centric applications like Diarium and Day One.13 By guaranteeing that users can always take their data with them, the app ensures it is a vessel for memories, not a vault that holds them captive.
* **Transparency (Open-Source):** The complete source code for the application will be publicly available under an open-source license. This transparency is crucial for building and maintaining user trust, as it allows for independent auditing of the application's security and privacy claims. In a market where all major competitors are proprietary, closed-source products 19, this commitment to openness serves as a powerful testament to the project's user-first ethos and provides a verifiable guarantee that the privacy promises are being met in the code.

#### **1.4. Target User Profile: The Privacy-Conscious Lifelogger**

The target user is a technologically sophisticated individual who values deep self-reflection and personal data analysis but is constrained by the time and discipline required for traditional journaling. This user is characterized by a strong awareness of digital privacy issues and a healthy skepticism of entrusting their most personal data to large technology corporations.

They are likely early adopters, familiar with concepts like data sovereignty, self-hosting, and decentralized protocols such as Nostr. They are intrigued by the potential of AI to unlock personal insights, as demonstrated by the user base of applications like Rosebud 20, but they are unwilling to compromise on data ownership to access these features. This user seeks a tool that is both powerful and principled, offering the advanced capabilities of modern AI without the privacy trade-offs inherent in cloud-based services.

### **2\. The User Experience and Feature Set**

#### **2.1. The "Daily Canvas": Anatomy of a Journal Entry**

Each day's entry is conceptualized as a "Daily Canvas," a rich, multimedia document that is automatically populated with the day's events, ready for the user's review and curation. This moves away from the "blank page" metaphor of traditional journals.

* **Core Components of the Canvas:**
  * **Text Summary:** An AI-generated narrative that synthesizes the day's activities into a coherent, prose-style draft. This serves as the primary suggested entry, which the user can then edit, expand, or replace.
  * **Image Gallery:** A curated collection of photos and videos captured by the user on that day, automatically sourced from the device's local media library.
    * **Photo Selection & Curation:** Users can curate which photos appear in each event or daily canvas through an intuitive selection interface:
      * **Edit Mode:** Tap "Edit" on the Photo Memories section to enter selection mode
      * **Visual Selection:** All photos taken on that day are displayed in a grid with clear include/exclude indicators
      * **Tap to Toggle:** Simply tap any photo to include or exclude it from the event
      * **Fullscreen Preview:** Tap photos in edit mode to view fullscreen with swipe navigation between photos
      * **Selection Indicators:** Green checkmarks for included photos, red X for excluded photos
      * **Dual View Modes:** Grid view for quick selection, carousel view for detailed review
      * **Real-time Updates:** Changes are immediately reflected in the Daily Canvas and event details
    * This mirrors the Daily Canvas > Media tab workflow, ensuring consistent photo management across the app
  * **Location Map:** An interactive map visualization that displays the user's movements, routes, and significant locations visited throughout the day. This provides a geographic context to the day's events, similar to the map views offered by Day One.17
  * **Data Timeline:** A chronological, itemized list of discrete, automatically captured events. This can include calendar appointments, fitness activities, music listened to, and other integrated data points, providing a factual backbone to the narrative summary.
    * **Location Display:** Rather than showing individual location points, the timeline displays location clusters representing meaningful stays. Each cluster entry shows:
      * With reverse geocoding enabled: Named location (e.g., "Empire State Building") with duration spent (e.g., "You spent 45 min here")
      * Without reverse geocoding: Generic "Location" label, or high-level region (city/county) if determinable (e.g., "Brooklyn"), with duration spent
      * The timeline header shows total clusters visited (e.g., "5 locations") rather than raw data point counts

#### **2.2. The Passive Data Capture Engine**

The engine is the heart of the "automatic" functionality, operating in the background (with explicit and granular user consent) to aggregate the raw data that forms the Daily Canvas.

* **Data Sources (P0 \- Must-Have for MVP):**
  * **Location Services:** Utilizes the device's GPS to track significant locations and movements, forming the basis of the map view and providing context for other events.
  * **Photo Library Access:** Scans the user's on-device photo library for media created on the current day. This process includes the on-device extraction of EXIF metadata, such as timestamps and geolocations, to accurately place photos in the daily timeline.23
* **Data Sources (P1 \- High Priority Research & Implementation):**
  * **System Calendar Integration:** Reads data from the device's native calendar to automatically import appointments, meetings, and scheduled events, a key feature for contextualizing the day as seen in Diarium.25
  * **Health & Fitness Data:** Integrates with platform-specific health services (Apple Health via HealthKit and Google Fit) to automatically log workouts, step counts, and other wellness metrics. This type of integration is a value-add in apps like Rosebud and Diarium.13
  * **Bluetooth Proximity Events:** Leverages Bluetooth Low Energy (BLE) to detect and log proximity to other devices running the app or specific, user-designated BLE beacons. This "Bluetooth exchange" can create a passive social graph, noting when time is spent with other users, adding a unique layer of social context to the private journal.
* **Data Sources (P2 \- Future Exploration):**
  * **Plugin-Based Service Integrations:** An extensible system, conceptually similar to IFTTT, that would allow users to connect to third-party services (e.g., Spotify for music history, Strava for detailed activity logs, social media for posts). This mirrors a powerful feature of Day One.17 To adhere to the local-first principle, these plugins would run on-device, pulling data from APIs rather than pushing data to a central server.

#### **2.3. The On-Device AI Journaling Assistant: Synthesis and Interaction**

This module is responsible for transforming the raw, collected data into a meaningful and interactive journal experience. All processing will be performed entirely on-device to uphold the application's strict, no-cloud privacy guarantees.

* **Daily Summary Generation:** The AI assistant will analyze the structured data collected for the day—locations visited, photos taken, calendar events, fitness activities—and generate a draft journal entry using an on-device text generation model. This narrative synthesis is inspired by the AI-driven analysis in apps like Rosebud, which helps users find meaning and patterns in their entries.2
  * **Narrative Tone Requirements:** Generated summaries must maintain an objective, factual tone based solely on observable data and reasonable inferences. The AI must not generate assumptions about the user's feelings or emotional state. Narratives should be natural and prose-style rather than mechanical or list-like, presenting events and activities as they occurred without subjective interpretation.
* **Voice-to-AI Editing:** A key interactive feature allowing the user to conversationally edit the generated entry. The user can issue voice commands such as, "Rewrite the afternoon section to sound more reflective," or "Add a bulleted list of the tasks I completed based on my calendar." This requires on-device speech-to-text (STT) and Natural Language Processing (NLP) to interpret intent and modify the text. This extends the voice journaling capabilities seen in apps like Rosebud and Daybook into a truly interactive editing experience.2
* **Insight and Trend Analysis:** Over longer periods, the AI assistant will analyze the journal database to identify and surface patterns, trends, and correlations. Examples include identifying the most frequently visited locations, recognizing that the user's mood (if manually tagged) is often higher on days with fitness activity, or highlighting recurring social interactions. This long-term memory and pattern recognition is a core value proposition of advanced AI journaling apps.20

#### **2.4. User Control: Curation, Permissions, and Manual Entry**

While automation is the primary focus, the user always retains ultimate control over their journal's content and data permissions.

* **Fully Editable Entries:** The AI-generated summary is always presented as a suggestion. The user has complete freedom to edit, add to, delete, or entirely replace the generated text before saving the entry.
* **Media Curation:** Users can manually add or remove photos, videos, audio recordings, and other media from the Daily Canvas, ensuring the visual record of their day is accurate and meaningful.
* **Event Details Editing:** Timeline events can be tapped to view detailed information and perform comprehensive editing:
  * **Title & Description:** Edit event titles and add detailed descriptions with full text editing capabilities
  * **Photo Management:** Access the same photo selection interface used in Daily Canvas Media tab to include/exclude photos from specific events
  * **Visual Consistency:** Edit mode provides the same grid/carousel views with include/exclude indicators for intuitive photo curation
  * **Fullscreen Viewing:** All photos maintain aspect ratios in thumbnails and support fullscreen viewing with swipe navigation
  * **Real-time Sync:** Changes to event photos immediately reflect in both the Event Details view and the Daily Canvas
* **Transparent and Granular Permissions:** The application will not request permissions on first launch. Instead, it will ask for each permission in-context, at the moment the user tries to use a feature that requires it.32 Each request will be preceded by a clear, plain-language explanation of why the permission is needed and what benefit it provides.33 A dedicated settings screen will allow users to easily review and toggle all granted permissions at any time.
* **Traditional Manual Entry:** The ability to create a classic, blank-slate journal entry will always be a primary and easily accessible feature, ensuring the app can also serve as a conventional diary when desired.

#### **2.5. Data Sovereignty: Export, Backup, and Synchronization**

These features are critical to fulfilling the core principles of data ownership and long-term preservation. All backup and sync options are optional, user-initiated, and encrypted on the client-side before any data leaves the device.

* **Complete Data Export:** The application will feature a robust export function that packages the user's entire journal—all text, media, and metadata—into a single, portable archive. The format will be well-documented and based on open standards (e.g., a ZIP file containing JSON and Markdown files) to ensure it can be easily parsed, archived, or imported into other systems. This is a crucial feature for data permanence, as offered by leading apps like Day One and Diarium.13
* **Flexible Encrypted Backups & Sync:** Users can initiate end-to-end encrypted backups to a destination of their choice. The app will provide a simple, easy-to-use interface for setting up these optional services:
  * **Decentralized Storage (Blossom):** The primary integration for decentralized, censorship-resistant backups.
  * **Peer-to-Peer Sync (Syncthing):** Users can designate a local folder to be managed by the open-source tool Syncthing, enabling direct, peer-to-peer synchronization between their own devices without a central server.35
  * **User-Provided Cloud (Google Drive, etc.):** Users can connect their own Google Drive account. The application will only request permission to access its own application data folder, ensuring it cannot see or interact with any other user files.38
  * **Local Storage:** A simple option to save the encrypted backup file directly to the device's local storage or an external drive.

### **3\. Competitive and Strategic Analysis**

#### **3.1. Market Positioning and Differentiators**

The app will be positioned in the market as the definitive journaling application for users who refuse to compromise between advanced, AI-powered features and absolute data privacy. It directly addresses a significant gap in the current landscape, where users are typically forced to choose one over the other.

* **Key Differentiators:**
  1. **Strictly Local-First Architecture:** This is the most significant technical and philosophical differentiator from all major competitors, who rely on some form of cloud synchronization for their core functionality.
  2. **Verifiable Transparency via Open Source:** Unlike the proprietary nature of Day One, Rosebud, and Journey 19, the app's open-source codebase provides a verifiable guarantee of its privacy claims.
  3. **Automation-First Workflow:** While other apps have automatic features, this app's core workflow is built around passively capturing the day and presenting a pre-assembled entry, fundamentally changing the user's role from creator to curator.
  4. **Native Decentralized Integrations:** The planned support for Nostr, Blossom, and potentially the Lightning Network is unique in the journaling space and appeals directly to a forward-thinking, privacy-centric, and technically literate user base.

The strategic positioning is not to compete on every feature with incumbents, but to win decisively on the principles of privacy, control, and transparency, while offering a uniquely powerful, automated journaling experience. This approach carves out a defensible niche for a user segment that is currently underserved by the market.

#### **3.2. Competitive Feature Matrix**

The following table provides a comparative analysis of the proposed features against leading applications in the digital journaling market. The analysis reveals a clear market opportunity: no existing application successfully combines a high degree of AI-driven automation with a strict, local-first, open-source architecture. Competitors generally force a trade-off, offering powerful features at the cost of data control (Day One, Rosebud) or offering greater data control with more limited, traditional functionality. This app is designed to eliminate this trade-off.

| Feature | \[App Name\] (Proposed) | Day One | Rosebud AI | Journey | Diarium |
| :---- | :---- | :---- | :---- | :---- | :---- |
| **Core Principle** | Automatic Lifelogging | Manual Entry & Curation | Guided AI Self-Reflection | Multi-platform Manual Entry | Aggregated Manual Entry |
| **Data Storage Model** | **Local-First (On-Device)** | Cloud Sync (E2EE) 19 | Cloud Sync (Encrypted) 41 | Cloud Sync (E2EE option) 3 | User's Cloud (Google Drive, etc.) 13 |
| **Source Code** | **Open-Source & Auditable** | Proprietary 19 | Proprietary | Proprietary | Proprietary |
| **AI: Entry Generation** | **Yes (On-Device Summary)** | No | No (Provides Prompts) 20 | No (AI is for Q\&A) 3 | No |
| **AI: Entry Analysis** | Yes (On-Device Trends) | No | **Yes (Core Feature)** 2 | Yes (Odyssey AI Q\&A) 3 | No |
| **AI: Voice Interaction** | **Yes (On-Device Editing)** | Dictation only 22 | Voice Journaling & Transcription 21 | Voice Note Recording 3 | Dictation only 42 |
| **Automatic Data Capture** | **Core (Location, Photos, Calendar, Health, BLE)** | Metadata (Loc, Weather), IFTTT 22 | Health Integrations 20 | Metadata (Loc, Weather) 43 | **Extensive (Social, Calendar, Health, etc.)** 25 |
| **Data Export** | **Yes (Well-documented JSON/MD)** | Yes (PDF, JSON, TXT) 18 | Unspecified | Yes (DOCX, PDF) 3 | **Yes (DOCX, HTML, RTF, TXT)** 13 |
| **Decentralized Integration** | **Yes (Nostr, Blossom, Lightning)** | No | No | No | No |

#### **3.3. Journal Entry Auto-Generation Requirements**

**Data Prerequisites** (CRITICAL - Production Enforcement):
- **Minimum Requirement**: At least ONE data point must exist from ANY source
- **Valid Data Sources**:
  - Photos (device media library with EXIF data)
  - Location points (GPS tracking data)
  - Calendar events (system calendar integration)
  - Movement data (step counts, activities)
  - Activity data (tracked activities, workouts)
  - Timeline events (synthesized events from all sources)
- **Production Behavior**: Auto-generation is DISABLED for dates without any data
- **Development Mode**: Test data seeding ONLY occurs in debug builds (`kDebugMode`), never in production
- **User Experience**:
  - Clear error message when attempting auto-generation without data
  - Informative guidance on how to enable auto-generation (add photos, visit locations, create calendar events)
  - Manual entry always available regardless of data availability
- **Data Validation**: System validates data availability before allowing auto-generation attempt

**Rationale**:
- Prevents empty or meaningless journal entries in production
- Ensures AI has sufficient context to generate meaningful narratives
- Maintains data integrity and user trust
- Avoids confusion about why entries exist for dates without actual activities

### **4\. Monetization Strategy**

Monetizing an open-source, privacy-first application presents a unique challenge. The strategy must generate sustainable revenue without compromising the core principles of user data control and transparency. Models that rely on advertising or the sale of user data are explicitly rejected as they are fundamentally incompatible with the project's ethos.88 Instead, a hybrid model based on direct value exchange is proposed.

#### **4.1. Primary Model: Open Core (Freemium)**

The primary monetization strategy will be an "Open Core" or Freemium model.90 The core application will be free, open-source, and fully functional for all essential journaling features. A paid "Pro" version, available via a subscription or a one-time purchase, will unlock advanced, non-essential features for power users.

* **Free Tier (Core Product):** Includes all features detailed in this document: automatic data capture, on-device AI summary generation, voice editing, manual entry, multimedia support, full data export, and standard encrypted backup options. The free version will be fully usable and not artificially limited.
  * **Cloud AI Limit:** 3 AI-powered summaries per day via managed Cloud Gemini endpoint
  * **Template Fallback:** Unlimited high-quality on-device narrative generation
  * **Reset Schedule:** Daily limit resets at midnight local time
  * **UI Indicators:** Clear counter showing remaining AI generations (e.g., "✨ 2/3 AI summaries remaining today")
  * **Graceful Degradation:** Automatic fallback to Template adapter when limit reached

* **Pro Tier Features ($4.99/month or $49.99/year):**
  * **Unlimited Cloud AI:** 25 AI-powered summaries per day via managed endpoint
    * Covers Today page auto-generation
    * Covers History page regeneration requests
    * Includes manual "Regenerate with AI" actions
    * No watermarks or branding on generated content
  * **Advanced AI Insights:** Deeper, long-term trend analysis (e.g., "How has my mood correlated with my location over the past year?")
  * **Priority Processing:** Faster AI response times during peak usage
  * **Advanced AI Features:**
    * Multimodal image descriptions for photo context
    * Custom prompt templates for personalized narrative style
    * Voice-to-text with AI enhancement
  * **Enhanced Data Visualizations:** More sophisticated map overlays, activity charts, and relationship graphs
  * **Expanded Backup & Sync Options:** Access to a wider range of automated, user-configured cloud sync providers
  * **Premium Export Formats:** Beautifully designed PDF or eBook templates for printing physical copies of the journal
  * **Exclusive Themes & Customization:** A wider selection of UI themes, fonts, and layout options
  * **Priority Support:** Faster response times for support inquiries

* **Power User Option (BYOK - Free or Pro):**
  * **Bring Your Own Key:** Users can provide their own Gemini API key
  * **No Limits:** Unlimited AI generations (user pays Google directly)
  * **Full Control:** Complete data and cost control
  * **Privacy Option:** For users who want cloud AI but prefer direct API relationship
  * **Configuration:** API key stored securely via flutter_secure_storage or .env file

This model provides a clear value proposition for users to upgrade while ensuring the free, open-source version remains a powerful tool in its own right.90

#### **4.1.1. Authentication & Tier Detection Strategy**

The application implements a **Hybrid Anonymous-First Authentication Model** designed to maximize user convenience while supporting both free and Pro tiers without compromising privacy principles.

* **Free Tier Users (Anonymous, Zero Friction):**
  * No account or sign-up required
  * Anonymous device ID for rate limiting only (3 AI generations per day)
  * Complete privacy - no personal information collected
  * All journal data remains on-device

* **Pro Tier Users (Minimal Friction with Optional Sync):**
  * Immediate activation after in-app purchase (25 AI generations per day)
  * Device-specific by default - no account needed
  * Optional account linking for multi-device sync
  * Privacy-respecting authentication options (Sign in with Apple, email/magic link)

* **Key Principles:**
  * Free tier is completely anonymous with zero friction
  * Pro tier activates instantly via receipt validation
  * Account creation is optional, even for Pro users
  * Privacy guarantees maintained across all tiers
  * BYOK users can bypass rate limiting entirely with their own API key

#### **4.2. Secondary Models: Direct Support**

To supplement the primary model and engage the community, several direct support mechanisms will be integrated.

* **Donations & Sponsorships:** The application will accept direct financial contributions through platforms like GitHub Sponsors and Open Collective.93 This allows users and organizations who benefit from the project to support its ongoing development. The project will also actively seek corporate sponsorships from companies aligned with the values of privacy and open-source software.96
* **Value-for-Value (Lightning Network):** In alignment with the decentralized ethos, the app will integrate "zaps"—small, instant payments over the Bitcoin Lightning Network.97 This allows users to send micropayments as a form of appreciation directly within the app, offering a frictionless way to support the project.
* **Paid Support:** For enterprise or professional users who may require dedicated assistance, a paid support model will be considered for future implementation.99 This could include guaranteed response times, integration support, or custom feature development, providing a valuable service without altering the core product.90

#### **4.3. Future Consideration: Plugin Marketplace**

As the user base and developer community grow, a plugin marketplace could be introduced. This would allow third-party developers to create and sell themes, advanced data importers (e.g., for specific fitness trackers), or unique visualization tools. The project would take a small commission on sales, creating a self-sustaining ecosystem that enhances the app's functionality while generating revenue.103

This multi-faceted strategy creates a resilient financial foundation, balancing the need for sustainable development with an unwavering commitment to user privacy and open-source principles.

## **Part II: Technical Design Document (TDD)**

### **5\. System Architecture and Technology Stack**

#### **5.1. The Flutter & Purplestack Foundation**

The application will be developed using the Flutter framework, enabling a single codebase for cross-platform deployment on both iOS and Android. The user's specification to use Purplestack dictates key components of the technology stack.44 Purplestack is identified as a development stack for building Nostr-enabled Flutter applications, centered around Riverpod for state management and a component set referred to as Purplebase.44

Given the limited public documentation on the complete Purplestack architecture 44, this TDD will proceed by adopting its known core components and integrating them within established best practices for scalable Flutter application architecture. The architecture will be layered, separating concerns into data, domain, business logic, and presentation layers to ensure maintainability and testability.45 Riverpod will be used as the dependency injection and state management framework throughout the application.

#### **5.2. Local-First Data Architecture: A Deep Dive**

The system's architecture is fundamentally local-first, a paradigm where the primary copy of all data resides on the client device.15 The on-device database serves as the single source of truth. This design choice has profound architectural implications:

* **Offline Capability:** The application will be fully functional without an internet connection. All core features—data capture, AI analysis, entry creation, and viewing—will operate seamlessly offline.
* **Performance:** By eliminating network latency for all primary operations, the user experience will be exceptionally fast and responsive, avoiding loading spinners and delays common in cloud-dependent apps.15
* **Data Control:** The user retains complete physical control of their data. Network connectivity is relegated to an optional, user-initiated role for specific tasks such as pulling data from external APIs (e.g., weather), publishing to Nostr, or executing encrypted backups.

#### **5.3. AI Architecture: Privacy-First with Optional Cloud Enhancement**

The AI system employs a tiered adapter architecture that prioritizes privacy while optionally allowing users to trade privacy for enhanced quality. This architecture ensures the app remains fully functional regardless of user privacy preferences.

* **Tier 1: Cloud AI (Optional, Requires Consent & API Key)**
  * **Provider:** Google Gemini 2.0 Flash (or user-configured cloud model)
  * **Quality:** Highest quality narratives with superior context understanding
  * **Requirements:**
    * Explicit user consent via settings with clear privacy warning
    * User-provided API key (loaded from .env file or settings UI)
    * Network connectivity
  * **Privacy Trade-off:** Journal data is sent to Google's servers for processing
  * **Availability:** Automatically disabled if user hasn't consented or API key is missing

* **Tier 3: Template-Based Generation (Privacy-First Fallback)**
  * **Provider:** On-device template-based narrative builder
  * **Quality:** Good quality narratives using contextual templates and phrase generation
  * **Requirements:** None - always available
  * **Privacy:** 100% on-device, zero network communication
  * **Availability:** Guaranteed fallback ensuring app never fails to generate summaries

* **Graceful Degradation Guarantees:**
  1. App works perfectly without any cloud AI configuration
  2. Users who never provide API key or consent get full functionality via Template adapter
  3. Cloud AI fails gracefully to Template adapter on network issues or API errors
  4. Clear UI indication of which adapter is active (cloud vs. local)
  5. No degradation in app features - only narrative quality varies by user choice

* **Privacy-First Pipeline Architecture:**
  1. **Ingestion:** The Data Acquisition Layer continuously gathers raw data points (e.g., GPS coordinates, photo file paths, calendar event objects) from device sensors and APIs.
  2. **Normalization:** This raw data is transformed into a standardized, structured format and persisted in the local database. For example, a raw GPS coordinate is stored as a Location object with a timestamp and associated metadata.
  3. **Analysis & Synthesis:** At the end of the day (or on-demand), a service layer retrieves all normalized data for that period. This data is processed by the active AI adapter based on availability and user preferences.
  4. **Generation:**
     * If Cloud AI is available (consent granted, API key configured, network accessible): Structured data is sent to Gemini API for narrative generation
     * Otherwise: Template-based builder uses contextual phrase generation and emotional tone analysis for on-device narrative creation
  5. **Interaction & Curation:** The generated draft is presented to the user in the UI. All edits remain on-device regardless of generation method.

### **6\. Core Module Implementation**

#### **6.1. Data Acquisition Layer: Sensors, Metadata, and Integrations**

This layer is composed of specialized services responsible for interfacing with the device's hardware and platform APIs to collect data passively.

* **Location Service:** Utilizes a Flutter package such as location to handle permissions and subscribe to background location updates from the platform's native location services (Core Location on iOS, Fused Location Provider on Android).
* **Photo Metadata Service:** Employs the photo\_manager package 49 to efficiently query the device's media library for new photos and videos within a specific date range without having to scan the entire filesystem. For each retrieved media file, the
  metadata 24 or
  exif 23 package will be used to parse the EXIF data directly from the file bytes on-device, extracting critical metadata like the precise timestamp and GPS coordinates.
* **Bluetooth Proximity Service:** Implements a BLE scanner using the flutter\_blue\_plus package, which is well-maintained and supports central role functionalities on iOS and Android.51 The service will periodically scan for other devices running the app or user-configured beacons. Proximity will be inferred by analyzing the Received Signal Strength Indicator (RSSI), with stronger signals indicating closer proximity.53 These proximity "events" (e.g., "in proximity of device X from 14:00 to 15:30") will be logged to the database.
* **On-Device Image Analysis Service (Face Tagging):** To automatically suggest tags for people in photos while preserving privacy, a multi-step on-device machine learning pipeline will be implemented.
  1. **Face Detection:** For each new photo, the google\_mlkit\_face\_detection package 54 will be used to identify the bounding boxes of all faces present in the image. It is crucial to distinguish this from face
     *recognition*; this step only finds faces, it does not identify them.55
  2. **Face Embedding Generation:** Each detected face, cropped from the original image, will be passed through a lightweight, on-device face recognition model (e.g., a TFLite-converted version of FaceNet or MobileFaceNet).57 This model does not identify the person but outputs a high-dimensional vector, or "embedding," that numerically represents the facial features.
  3. **Clustering and Recognition:** The first time a face embedding is generated, the user is prompted to label it (e.g., "Jane Doe"). This embedding is stored in the local database, associated with the label. For subsequent photos, new face embeddings are compared to the stored, labeled embeddings (e.g., using cosine similarity or Euclidean distance). If a new embedding is sufficiently close to a known one, the app automatically suggests the corresponding label. This entire process occurs offline, ensuring that facial data never leaves the device.57

#### **6.2. Local Database Architecture and Schema**

The selection of the local database is a critical architectural decision. The data model is inherently relational: a single JournalEntry is linked to multiple Photos, Locations, Events, and Tags. This relational complexity strongly favors a SQL-based solution.

Within the Flutter ecosystem, Drift (formerly Moor) stands out as the premier choice. It is a reactive persistence library built on top of the robust and universally trusted SQLite engine.59 Drift's key advantage is that it allows developers to write type-safe, composable SQL queries directly in Dart, providing the power of SQL with the safety of a modern programming language.61 Its maturity, excellent documentation, and the stability of its underlying SQLite foundation make it the most reliable choice for an application intended to safeguard a user's most precious memories over a lifetime.

##### **6.2.1. Local Database Technology Comparison**

| Criteria | Drift (SQLite) | Isar (NoSQL) | Hive (NoSQL) | Recommendation |
| :---- | :---- | :---- | :---- | :---- |
| **Data Model** | Relational (Tables, Rows) | Object-based (Collections) | Key-Value (Boxes) | **Drift**. The relational model is superior for managing the complex, interconnected data of a journal entry. |
| **Query Language** | Type-safe SQL in Dart | Type-safe query builder | Simple key-based access | **Drift**. Essential for complex queries like "find all photos with Jane Doe taken in Paris during July." |
| **Performance** | Excellent, highly optimized for complex queries. | Extremely fast for individual object reads/writes. | Extremely fast for simple key-value operations. | **Drift**. While Isar/Hive may be faster for simple C.R.U.D., Drift's query performance is paramount for data analysis. |
| **Data Integrity** | Strong (ACID, foreign keys) | Strong (ACID transactions) | Strong (ACID transactions) | **Drift**. Native support for foreign key constraints simplifies the enforcement of relationships between tables. |
| **Ecosystem & Maturity** | Very mature, built on the rock-solid SQLite foundation. Excellent documentation. 59 | Popular, but has a history of maintenance changes affecting stability perceptions. 59 | Community-maintained after being abandoned by the original author, raising long-term support questions. 59 | **Drift**. The stability and longevity of the SQLite engine are critical for an archival application like a journal. |

#### **6.3. On-Device AI and Voice Interaction Module**

This module is architected to perform all AI tasks locally, ensuring no user data is ever transmitted to a cloud service for processing. This is a significant technical challenge but is core to the app's value proposition.

* **On-Device Summarization Service:** This service will utilize a mobile-optimized, quantized version of a large language model (e.g., Google's Gemma or a similar transformer-based model). The model will be accessed via the tflite\_flutter package. Its input will be a structured JSON object representing the day's normalized data, and its output will be a Markdown-formatted string constituting the draft journal entry.
* **On-Device Voice Interaction Service:** This module will use a fully on-device Speech-to-Text (STT) engine. While the standard speech\_to\_text Flutter package often relies on platform services that may require network access 63, this implementation will prioritize a solution that guarantees offline functionality, potentially by bundling a TFLite-based STT model. The transcribed text will then be processed by the on-device NLP model to interpret user commands for editing the journal entry.

#### **6.4. UI/UX Component Architecture**

The user interface will be constructed entirely with Flutter widgets, ensuring a consistent look and feel across platforms. State management will be handled declaratively and reactively using the Riverpod framework, as per the Purplestack specification.44

* **Primary Navigation:** The main application interface will feature a timeline or calendar view, allowing for intuitive navigation through the user's history. This is a proven and effective pattern seen in leading apps like Day One and Diarium.22
* **The Daily Canvas View:** This will be the main screen for interacting with a single day's entry. It will be a composite view composed of several specialized widgets: an interactive map widget (using a package like flutter\_map), a horizontally scrolling image gallery, and a rich text editor for the journal entry itself.
* **Permissions Management UI:** A dedicated section within the app's settings will provide a centralized dashboard for users to view the status of all relevant permissions (Location, Photos, etc.). Each permission will have a toggle switch and a clear, concise explanation of the feature it enables, allowing users to easily manage their privacy settings.32

### **7\. Decentralization and Data Integrity Strategy**

#### **7.1. Nostr Integration for Event Publishing**

The integration with Nostr is a key feature that aligns with the project's ethos of user sovereignty and censorship resistance.64 It provides a mechanism for users to selectively share moments from their private, local-first journal with a global, decentralized social network. The user's identity on Nostr is managed via a public/private key pair, which is self-sovereign and not tied to any central server.65

* **Implementation Strategy:**
  * The app will function as a Nostr "publishing client."
  * A robust Dart library, such as the Dart Nostr Development Kit (NDK) 69 or
    dart\_nostr 70, will be used to handle key management, event signing, and communication with Nostr relays.
  * A "Share to Nostr" function will be available on individual journal entries or media items, allowing the user to craft a "short text note" (Nostr Kind 1 event) 71 to be signed and broadcast.

#### **7.2. Flexible Encrypted Backup & Sync Architecture**

To provide maximum flexibility while maintaining user control, the app will support multiple, optional backup and synchronization methods. All methods will perform encryption on the device before any data is transmitted.

* **Decentralized Storage (Blossom Protocol):** This remains a primary option for secure, user-controlled, decentralized storage. Blossom is a protocol for storing binary files ("blobs") within the Nostr ecosystem.72 The implementation will use a Dart Nostr library with Blossom file support to upload the fully encrypted database file.69
* **Peer-to-Peer Synchronization (Syncthing):** The app will support Syncthing, a powerful open-source peer-to-peer file synchronization tool.35 Rather than bundling the Syncthing daemon, the app will allow the user to select a local directory for backups. The user can then configure their standalone Syncthing client to watch this directory, enabling robust and private synchronization across their personal devices.
* **User-Provided Cloud Storage (Google Drive):** For user convenience, an integration with Google Drive will be offered. Using the googleapis and google\_sign\_in packages, the app will request the drive.file scope. This specific scope restricts the app's access exclusively to files that it has created, preventing it from accessing any other user data on their Drive and thus preserving privacy.38
* **Local File Backup:** The simplest option will allow the user to save the encrypted database file directly to a chosen folder on their device or an attached external storage device.

#### **7.3. Further Decentralization Avenues**

Beyond the core integrations, the architecture will be designed to accommodate future decentralized technologies.

* **Lightning Network Payments:** The app could incorporate optional value-for-value features using the Bitcoin Lightning Network. This could enable a future marketplace for user-created journal templates or plugins. Integration would be achieved via Nostr Wallet Connect (NIP-47), allowing the app to request payments from a user's remote Lightning wallet without taking custody of funds.75
* **Decentralized Identity (DIDs):** While a Nostr public key already serves as a basic form of decentralized identity, future development could explore formal adoption of W3C DID standards. This would enhance interoperability with a broader ecosystem of decentralized services, allowing users to control their identity across different platforms.78

### **8\. Open-Source Strategy and Project Governance**

#### **8.1. License Selection**

Based on the project's foundational principles of user freedom, privacy, and transparency, the **GNU Affero General Public License v3 (AGPLv3)** has been selected. This strong copyleft license acts as a legal safeguard for the project's ethos. It requires that any distributed modifications or derivative works—including those made available over a network—must also be licensed under the AGPLv3 and have their full source code made available.5 This ensures that the core values are perpetually preserved in any future versions or forks, explicitly preventing a scenario where a company could leverage the open-source code to build a proprietary, cloud-based service that undermines the very privacy principles the app is designed to protect.

#### **8.2. Public Repository Structure and Documentation Standards**

A well-structured and documented public repository is essential for fostering community trust, encouraging contributions, and enabling auditing. The project's GitHub repository will adhere to established best practices.82

* **Key Repository Files:**
  * README.md: A comprehensive document detailing the project's vision, features, and setup instructions.84
  * LICENSE: The full text of the AGPLv3 license.
  * CONTRIBUTING.md: A guide for potential contributors, outlining the project's branching model and pull request process.85
  * CODE\_OF\_CONDUCT.md: Establishes clear and respectful community standards.
  * SECURITY.md: Provides a clear process for privately reporting security vulnerabilities.84
* **Source Code Folder Structure:** The Flutter project's lib/ directory will adopt a "feature-first" or "package-by-feature" structure. This is a recognized best practice for large, scalable Flutter applications.86 Code will be organized into directories corresponding to application features (e.g.,
  lib/data\_capture/, lib/ai\_summary/, lib/nostr\_publishing/, lib/database/), rather than by type (e.g., widgets/, models/).

#### **8.3. Data Export Format Specification**

To fulfill the "well-documented format" requirement, a formal specification for the data export will be created and maintained within the repository's documentation.

* **Proposed Export Format:** The export will be a single ZIP archive containing:
  * journal.json: A single JSON file containing an array of all journal entries. Each entry object will include its text content (in Markdown), timestamp, and other metadata. The structure will be rigorously defined in a SCHEMA.md file.
  * A /media directory: This folder will contain all the original, unmodified media files (photos, videos, audio recordings) associated with the journal entries, named with a unique identifier referenced in the journal.json file.

This hybrid structure is easily machine-readable for programmatic access while also being human-friendly, allowing users to directly browse their media files.
